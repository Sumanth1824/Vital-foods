<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Your Cart - Smoothie Juicy</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet"/>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f8f8f8; /* Very light gray background to match screenshot */
            color: #333; /* Dark text for contrast */
            display: flex;
            justify-content: center;
            align-items: flex-start; /* Align to top to give more space for content */
            min-height: 100vh;
            padding: 40px 16px; /* More padding top/bottom */
        }
        .container {
            background: #ffffff; /* White container background */
            border-radius: 0; /* No border-radius for a sharper look */
            box-shadow: none; /* No shadow */
            padding: 2rem;
            width: 100%;
            max-width: 1000px; /* Wider container */
            display: flex;
            flex-wrap: wrap; /* Allow wrapping for responsiveness */
            justify-content: space-between;
        }

        .cart-main-content {
            flex: 2; /* Take more space for cart items */
            min-width: 450px; /* Minimum width for cart items section */
            padding-right: 2rem; /* Spacing between cart and totals */
        }

        .cart-item {
            display: flex;
            align-items: flex-start; /* Align items to top for better text flow */
            padding: 1rem 0;
            border-bottom: 1px solid #eee; /* Light gray subtle border */
            position: relative; /* For absolute positioning of remove button */
        }
        .cart-item:last-child {
            border-bottom: none;
        }
        .cart-item img {
            width: 100px; /* Larger image */
            height: 100px; /* Larger image */
            object-fit: cover; /* Cover instead of contain */
            border-radius: 0; /* No border-radius */
            margin-right: 1.5rem;
        }
        .item-details {
            flex-grow: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }
        .item-name {
            font-weight: 500; /* Medium font weight */
            font-size: 1.25rem; /* Slightly larger name */
            margin-bottom: 0.5rem;
            color: #333;
        }
        .item-options {
            font-size: 0.9rem;
            color: #777;
            margin-bottom: 0.5rem;
        }
        .item-price-each {
            color: #555; /* Darker text for item price */
            font-size: 0.95rem;
        }
        .item-quantity-controls {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            margin-top: 1rem;
            border: 1px solid #ccc; /* Border around quantity controls */
            padding: 5px 10px;
        }
        .quantity-btn {
            background-color: transparent; /* Transparent button */
            color: #333; /* Dark text */
            width: 28px;
            height: 28px;
            border-radius: 0; /* No border-radius */
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-weight: normal; /* Normal font weight */
            border: none;
            font-size: 1.2rem;
            padding: 0;
        }
        .quantity-btn:hover {
            background-color: #eee; /* Slight hover effect */
        }
        .item-quantity-display {
            font-weight: 500;
            color: #333;
        }
        .item-total-price {
            font-weight: bold;
            font-size: 1.25rem;
            color: #333;
            margin-left: auto; /* Push total price to the right */
        }
        .remove-btn {
            background-color: transparent; /* Transparent remove button */
            color: #aaa; /* Gray 'x' */
            padding: 0;
            border-radius: 0;
            cursor: pointer;
            font-size: 1.5rem;
            position: absolute; /* Position absolutely */
            top: 1rem;
            left: 0;
            border: none;
        }
        .remove-btn:hover {
            color: #333; /* Darker 'x' on hover */
        }

        .cart-summary {
            flex: 1; /* Take less space for cart totals */
            min-width: 300px; /* Minimum width for summary section */
            background-color: #fbfbfb; /* Slightly different background for summary */
            padding: 2rem;
            border: 1px solid #eee; /* Subtle border for summary box */
        }

        .summary-heading {
            font-size: 1.5rem;
            font-weight: bold;
            margin-bottom: 1.5rem;
            color: #333;
        }

        .summary-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 1rem;
            padding-bottom: 0.5rem;
            border-bottom: 1px solid #eee;
        }
        .summary-row:last-of-type {
            border-bottom: none;
            margin-bottom: 0;
        }
        .summary-row span {
            color: #555;
        }
        .summary-row .total-amount {
            font-weight: bold;
            color: #333;
            font-size: 1.25rem;
        }

        .checkout-button {
            background-color: #333; /* Dark button */
            color: white;
            padding: 1rem 2rem;
            border-radius: 0;
            font-weight: bold;
            cursor: pointer;
            transition: background-color 0.3s ease;
            width: 100%; /* Full width */
            text-align: center;
            margin-top: 2rem;
            border: none;
        }
        .checkout-button:hover {
            background-color: #555; /* Slightly lighter on hover */
        }

        .continue-shopping-link {
            display: block;
            text-align: center;
            margin-top: 1.5rem;
            color: #777;
            text-decoration: none;
            font-size: 0.95rem;
        }
        .continue-shopping-link:hover {
            text-decoration: underline;
        }

        /* Customer Information and Checkout Form - Re-hiding as per screenshot */
        #checkout-form {
            display: none; /* Hidden by default in this layout */
        }
        .back-to-shop-btn {
            display: inline-block;
            margin-bottom: 2rem; /* Add space below the back button */
            background-color: grey;
            color: white; /* Gray text for back button */
            padding: 1rem;
            border-radius: 3rem;
            text-decoration: none;
            font-weight: normal;
            transition: color 0.3s ease;
            border: none;
            font-size: 0.9rem;
        }
        .back-to-shop-btn:hover {
            color: #333;
            background-color: whitesmoke;

        }
        /* Hide default form elements for now as per screenshot */
        .form-group, .flex.items-center.justify-between {
            display: none;
        }
        .message-box {
            position: fixed;
            bottom: 20px;
            right: 20px;
            padding: 15px 25px;
            border-radius: 8px;
            color: white;
            font-weight: bold;
            z-index: 1000;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            display: none; /* Hidden by default */
        }
        .message-box.success {
            background-color: #4CAF50; /* A standard green */
        }
        .message-box.error {
            background-color: #cc3333; /* Consistent red */
        }
        .hidden {
            display: none;
        }
        /* Media queries for responsiveness */
        @media (max-width: 768px) {
            .container {
                flex-direction: column;
                padding: 1rem;
            }
            .cart-main-content {
                padding-right: 0;
                margin-bottom: 2rem;
                min-width: unset;
            }
            .cart-summary {
                min-width: unset;
            }
        }
    </style>
</head>
<body>
    <div class="container">
      <div style="width: 100%; margin-bottom: 2rem;">
        <!-- Changed from <a> to <button> -->
        <button type="button" class="back-to-shop-btn" onclick="window.location.href='3.html';">Back</button>
      </div>

        <div class="cart-main-content">
            <h1 class="text-3xl font-bold mb-8 text-left">YOUR CART</h1>

            <!-- The empty cart message is now OUTSIDE the container that gets cleared -->
            <p id="empty-cart-message" class="text-center text-gray-500 mb-8 hidden">Your cart is empty. Please add items to continue shopping.</p>

            <div id="cart-items-container" class="mb-8">
                <!-- Cart items will be dynamically added here -->
            </div>

            <!-- Optional: Add fields for customer info before checkout -->
            <div class="customer-info-form mt-8 p-4 border border-gray-200" style="display: none;" id="customer-info-area">
                <h2 class="text-xl font-semibold mb-4">Customer Information</h2>
                <div class="mb-4">
                    <label for="customerName" class="block text-gray-700 text-sm font-bold mb-2">Your Name:</label>
                    <input type="text" id="customerName" class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" placeholder="Enter your name" required>
                </div>
                <div class="mb-4">
                    <label for="customerEmail" class="block text-gray-700 text-sm font-bold mb-2">Your Email:</label>
                    <input type="email" id="customerEmail" class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" placeholder="Enter your email" required>
                </div>
                <div class="mb-4">
                    <label for="customerMobile" class="block text-gray-700 text-sm font-bold mb-2">Your Mobile Number:</label>
                    <input type="tel" id="customerMobile" class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" placeholder="Enter your mobile number" required>
                </div>
                <button class="checkout-button" id="confirm-checkout-btn">CONFIRM ORDER</button>
            </div>
        </div>


        <div class="cart-summary">
            <h2 class="summary-heading">CART TOTALS</h2>
            <div class="summary-row">
                <span>Shipping (3-5 Business Days)</span>
                <span>Free</span>
            </div>
            <div class="summary-row">
                <span>TAX (estimated for the United States (US))</span>
                <span>$0</span>
            </div>
            <div class="summary-row">
                <span>Subtotal</span>
                <span id="cart-subtotal" class="total-amount">$0.00</span>
            </div>
            <div class="summary-row">
                <span>Total</span>
                <span id="cart-total" class="total-amount">$0.00</span>
            </div>
            
            <button class="checkout-button" id="proceed-to-checkout-btn">PROCEED TO CHECKOUT</button>
            <a href="3.html" class="continue-shopping-link">CONTINUE SHOPPING</a>
        </div>

        <div id="message-box" class="message-box"></div>
    </div>

    <script>
        const cartItemsContainer = document.getElementById('cart-items-container');
        const cartTotalSpan = document.getElementById('cart-total');
        const cartSubtotalSpan = document.getElementById('cart-subtotal');
        const emptyCartMessage = document.getElementById('empty-cart-message');
        const proceedToCheckoutBtn = document.getElementById('proceed-to-checkout-btn');
        const messageBox = document.getElementById('message-box');
        const cartSummarySection = document.querySelector('.cart-summary');
        const customerInfoArea = document.getElementById('customer-info-area');
        const confirmCheckoutBtn = document.getElementById('confirm-checkout-btn');
        const customerNameInput = document.getElementById('customerName');
        const customerEmailInput = document.getElementById('customerEmail');
        const customerMobileInput = document.getElementById('customerMobile'); // New: Mobile Input


        // --- Cart Management Functions ---
        function getCart() {
            const cart = localStorage.getItem('smoothieJuicyCart');
            return cart ? JSON.parse(cart) : [];
        }

        function saveCart(cart) {
            localStorage.setItem('smoothieJuicyCart', JSON.stringify(cart));
            updateCartDisplay(); // Always update display after saving cart changes
        }

        function updateQuantity(productId, change) {
            let cart = getCart();
            const itemIndex = cart.findIndex(item => item.id === productId);

            if (itemIndex > -1) {
                cart[itemIndex].quantity += change;
                if (cart[itemIndex].quantity <= 0) {
                    cart.splice(itemIndex, 1); // Remove if quantity is 0 or less
                }
                saveCart(cart);
            }
        }

        function removeItem(productId) {
            let cart = getCart();
            cart = cart.filter(item => item.id !== productId);
            saveCart(cart);
        }

        function clearCart() {
            localStorage.removeItem('smoothieJuicyCart');
            updateCartDisplay();
        }

        // --- Display Cart Items ---
        function updateCartDisplay() {
            const cart = getCart();
            cartItemsContainer.innerHTML = ''; // IMPORTANT: Clear *only* the item display area

            let total = 0;

            if (cart.length === 0) {
                emptyCartMessage.classList.remove('hidden'); // SHOW the empty cart message
                cartSummarySection.classList.add('hidden'); // HIDE the cart summary
                proceedToCheckoutBtn.classList.add('hidden'); // Hide initial checkout button
                customerInfoArea.style.display = 'none'; // Hide customer form
            } else {
                emptyCartMessage.classList.add('hidden'); // HIDE the empty cart message
                cartSummarySection.classList.remove('hidden'); // SHOW the cart summary
                proceedToCheckoutBtn.classList.remove('hidden'); // Show initial checkout button

                cart.forEach(item => {
                    const itemTotal = item.price * item.quantity;
                    total += itemTotal;

                    const cartItemDiv = document.createElement('div');
                    cartItemDiv.className = 'cart-item';
                    cartItemDiv.innerHTML = `
                        <button class="remove-btn" data-id="${item.id}">Ã—</button>
                        <img src="${item.image}" alt="${item.name}"/>
                        <div class="item-details">
                            <div class="item-name">${item.name}</div>
                            <div class="item-options">${item.options || '100 mg / x1'}</div>
                            <div class="item-price-each">$${item.price.toFixed(2)} each</div>
                            <div class="item-quantity-controls">
                                <button class="quantity-btn" data-id="${item.id}" data-change="-1">-</button>
                                <span class="item-quantity-display">${item.quantity}</span>
                                <button class="quantity-btn" data-id="${item.id}" data-change="1">+</button>
                            </div>
                        </div>
                        <div class="item-total-price">$${itemTotal.toFixed(2)}</div>
                    `;
                    cartItemsContainer.appendChild(cartItemDiv);
                });
            }

            cartSubtotalSpan.textContent = `$${total.toFixed(2)}`;
            cartTotalSpan.textContent = `$${total.toFixed(2)}`; // Total includes subtotal for now
            addCartEventListeners();
        }

        // --- Event Listeners for Cart Actions ---
        function addCartEventListeners() {
            document.querySelectorAll('.quantity-btn').forEach(button => {
                button.onclick = null; // Clear previous handler
                button.onclick = (event) => {
                    const productId = event.target.dataset.id;
                    const change = parseInt(event.target.dataset.change);
                    updateQuantity(productId, change);
                };
            });

            document.querySelectorAll('.remove-btn').forEach(button => {
                button.onclick = null; // Clear previous handler
                button.onclick = (event) => {
                    const productId = event.target.dataset.id;
                    removeItem(productId);
                };
            });
        }

        // --- Event listener for "PROCEED TO CHECKOUT" button ---
        proceedToCheckoutBtn.addEventListener('click', () => {
            const cartData = getCart();
            if (cartData.length === 0) {
                showMessage("Your cart is empty. Please add items before proceeding to checkout.", "error");
                return;
            }
            // Show customer info form
            customerInfoArea.style.display = 'block';
            proceedToCheckoutBtn.classList.add('hidden'); // Hide initial checkout button
        });

        // --- Event listener for "CONFIRM ORDER" button (after customer fills info) ---
        confirmCheckoutBtn.addEventListener('click', async () => { // Made async to use await
            const customerName = customerNameInput.value.trim();
            const customerEmail = customerEmailInput.value.trim();
            const customerMobile = customerMobileInput.value.trim(); // Get mobile number

            if (!customerName || !customerEmail || !customerMobile) { // Validate mobile number
                showMessage("Please enter your name, email, and mobile number to proceed.", "error");
                return;
            }

            if (!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(customerEmail)) { // Simple email validation
                showMessage("Please enter a valid email address.", "error");
                return;
            }

            // Basic mobile number validation (e.g., only digits, min length)
            if (!/^\d{10,}$/.test(customerMobile)) { // Example: 10 or more digits
                showMessage("Please enter a valid mobile number (digits only, at least 10).", "error");
                return;
            }


            const cartData = getCart();
            const cartTotalValue = cartTotalSpan.textContent.replace('$', ''); // Get total without '$'

            // Prepare data to send to the server
            const orderDetails = {
                cartItems: cartData,
                cartTotal: cartTotalValue,
                customerName: customerName,
                customerEmail: customerEmail,
                customerMobile: customerMobile, // Include mobile number
            };

            // Disable button and show loading to prevent multiple submissions
            confirmCheckoutBtn.disabled = true;
            confirmCheckoutBtn.textContent = 'Sending Order...';

            try {
                // Send data to your Node.js server endpoint
                // IMPORTANT: Replace 'http://localhost:3000' with your actual server URL in production
                const response = await fetch('http://localhost:3000/send-order-email', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(orderDetails),
                });

                const data = await response.json();

                if (data.success) {
                    showMessage("Order placed successfully! A confirmation email has been sent.", "success");
                    clearCart(); // Clear cart after successful order
                    customerInfoArea.style.display = 'none'; // Hide form
                    customerNameInput.value = ''; // Clear fields
                    customerEmailInput.value = ''; // Clear fields
                    customerMobileInput.value = ''; // Clear mobile field
                } else {
                    showMessage(`Failed to place order: ${data.message}`, "error");
                }
            } catch (error) {
                console.error('Error sending order to server:', error);
                showMessage("There was a problem placing your order. Please try again.", "error");
            } finally {
                confirmCheckoutBtn.disabled = false;
                confirmCheckoutBtn.textContent = 'CONFIRM ORDER';
            }
        });

        // --- Message Box Function ---
        function showMessage(message, type) {
            messageBox.textContent = message;
            messageBox.className = `message-box ${type}`; // Apply success or error class
            messageBox.style.display = 'block'; // Show the message box

            setTimeout(() => {
                messageBox.style.display = 'none'; // Hide after 5 seconds
            }, 5000);
        }

        // Initial load
        window.onload = updateCartDisplay;
    </script>
</body>
</html>
